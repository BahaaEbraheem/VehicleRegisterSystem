<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>@ViewData["Title"] - نظام تسجيل المركبة </title>

    <!-- Bootstrap CSS with RTL support -->
    <link href="~/css/bootstrap.rtl.min.css" rel="stylesheet" />
    @* <link href="~/css/all.min.css" rel="stylesheet" />  *@
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />

    <style>
        /* تخصيص الخطوط العربية - Arabic font customization */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
        }

        .navbar-brand {
            font-weight: bold;
            font-size: 1.5rem;
        }

        .card {
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
            border: 1px solid rgba(0, 0, 0, 0.125);
        }

        .btn-primary {
            background-color: #0d6efd;
            border-color: #0d6efd;
        }

            .btn-primary:hover {
                background-color: #0b5ed7;
                border-color: #0a58ca;
            }

        .table th {
            background-color: #e9ecef;
            font-weight: 600;
        }

        .search-container {
            background: white;
            border-radius: 0.375rem;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        }

        .stats-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
        }

        .footer {
            background-color: #343a40;
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        /* تحسينات للعناصر التفاعلية - Interactive elements improvements */
        .btn {
            border-radius: 0.375rem;
            font-weight: 500;
        }

        .form-control:focus {
            border-color: #86b7fe;
            box-shadow: 0 0 0 0.25rem rgba(13, 110, 253, 0.25);
        }

        /* تحسينات للجداول - Table improvements */
        .table-hover tbody tr:hover {
            background-color: rgba(0, 0, 0, 0.075);
        }

        /* تحسينات للتنبيهات - Alert improvements */
        .alert {
            border-radius: 0.375rem;
            border: none;
        }

        /* تحسينات للشارات - Badge improvements */
        .badge {
            font-size: 0.75em;
            font-weight: 500;
        }
    </style>
</head>

<body>
    <header>
        <!-- شريط التنقل الرئيسي - Main navigation bar -->
        <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
            <div class="container">
                <a class="navbar-brand" href="/">
                    <i class="fas fa-car me-2"></i>
                    نظام تسجيل المركبات
                </a>

                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <div class="collapse navbar-collapse" id="navbarNav">
                    @{
                        var currentUserId = User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
                        var currentUserName = User.Identity?.Name;
                        var currentUserRole = User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value;
                        var isLoggedIn = User.Identity?.IsAuthenticated ?? false;
                        var isAdmin = User.IsInRole("Administrator");
                        var isOrderValidator = User.IsInRole("OrderValidator");
                        var isBoardRegistrar = User.IsInRole("BoardRegistrar");
                        var isUser = User.IsInRole("User");
                    }

                    @if (isLoggedIn)
                    {
                        <ul class="navbar-nav me-auto">
                            @* روابط لجميع المستخدمين *@
                            @if (isUser || isAdmin)
                            {
                                <li class="nav-item">
                                    <a class="nav-link" href="/Orders/Index">
                                        <i class="fas fa-car me-1"></i> الطلبات الحديثة والمعادة
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/Orders/Create">
                                        <i class="fas fa-plus me-1"></i> إنشاء طلب جديد
                                    </a>
                                </li>
                            }

                            @* روابط المدققين *@
                            @if (isOrderValidator || isAdmin)
                            {
                               
                                    <li class="nav-item">
                                        <a class="nav-link" href="/OrderValidator/PendingValidation">
                                            <i class="fas fa-tasks me-1"></i> الطلبات الغير مدققة 
                                        </a>
                                    </li>
                            
                              
                            }
                            @if (isOrderValidator)
                            {
                                <li class="nav-item">
                                    <a class="nav-link" href="/OrderValidator/InReview">
                                        <i class="fas fa-search me-1"></i> الطلبات قيد الإجراء
                                    </a>
                                </li>
                            }
                            @* روابط مسجلي اللوحات *@
                            @if (isBoardRegistrar || isAdmin)
                            {
                                <li class="nav-item">
                                    <a class="nav-link" href="/BoardRegistrar/Index">
                                        <i class="fas fa-cogs me-1"></i> الطلبات الغير مسجلة
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/BoardRegistrar/RegisterBoard">
                                        <i class="fas fa-id-card me-1"></i> تسجيل اللوحات
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a class="nav-link" href="/BoardRegistrar/ApprovedOrders">
                                        <i class="fas fa-id-card me-1"></i> الطلبات الناجحة
                                    </a>
                                </li>
                            }

                            @* روابط الإدارة *@
                            @if (isAdmin)
                            {
                                <li class="nav-item">
                                    <a class="nav-link" href="/Users/Index">
                                        <i class="fas fa-users me-1"></i> إدارة المستخدمين
                                    </a>
                                </li>
                          
                            }
                        </ul>

                        <ul class="navbar-nav">
                            <li class="nav-item dropdown">
                                <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                                    <i class="fas fa-user me-1"></i>
                                    @currentUserName (@currentUserRole)
                                </a>
                                <ul class="dropdown-menu">
                                    <li><a class="dropdown-item" href="/Account/LogoutConfirmation">تسجيل الخروج</a></li>
                                </ul>
                            </li>
                        </ul>
                    }
                    else
                    {
                        <ul class="navbar-nav ms-auto">
                            <li class="nav-item">
                                <a class="nav-link" href="/Account/Login">
                                    <i class="fas fa-sign-in-alt me-1"></i>
                                    تسجيل الدخول
                                </a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link" href="/Account/Register">
                                    <i class="fas fa-user-plus me-1"></i>
                                    إنشاء حساب
                                </a>
                            </li>
                        </ul>
                    }

                
                </div>
            </div>
        </nav>
    </header>


    <main class="container mt-4">
        <!-- عرض الرسائل - Display messages -->
        @if (TempData["SuccessMessage"] != null)
        {
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <i class="fas fa-check-circle me-2"></i>
                @TempData["SuccessMessage"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        @if (TempData["ErrorMessage"] != null)
        {
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>
                @TempData["ErrorMessage"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        @if (TempData["InfoMessage"] != null)
        {
            <div class="alert alert-info alert-dismissible fade show" role="alert">
                <i class="fas fa-info-circle me-2"></i>
                @TempData["InfoMessage"]
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
        }

        <!-- محتوى الصفحة الرئيسي - Main page content -->
        @RenderBody()
    </main>

    <!-- تذييل الصفحة - Page footer -->
    <footer class="footer mt-auto">
        <div class="container">
            <div class="row">
                <div class="col-md-6">
                    <h5>نظام تسجيل المركبات</h5>
                    <p class="mb-0">نظام شامل لتسجيل المركبات</p>
                </div>
                <div class="col-md-6 text-end">
                    <p class="mb-0">
                        <i class="fas fa-envelope me-2"></i>
                        bahaa.ebraheem812@gmail.com
                    </p>
                    <p class="mb-0">
                        <i class="fas fa-phone me-2"></i>
                        +963991640012
                    </p>
                </div>
            </div>
            <hr class="my-3">
            <div class="row">
                <div class="col-12 text-center">
                    <p class="mb-0">&copy; @DateTime.Now.Year جميع الحقوق محفوظة - Bahaa Ebraheem</p>
                </div>
            </div>
        </div>
    </footer>

    <!-- JavaScript Libraries -->
    <script src="~/lib/jquery-validation/dist/jquery-3.6.0.min.js"></script>
    <script src="~/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/error-handler.js" asp-append-version="true"></script>

    <!-- تطبيق JavaScript مخصص - Custom JavaScript -->
    <script>
        // إخفاء التنبيهات تلقائياً بعد 5 ثوان
        // Auto-hide alerts after 5 seconds
        setTimeout(function () {
            var alerts = document.querySelectorAll('.alert');
            alerts.forEach(function (alert) {
                var bsAlert = new bootstrap.Alert(alert);
                bsAlert.close();
            });
        }, 5000);

        // تحسين تجربة المستخدم للنماذج
        // Improve user experience for forms
        document.addEventListener('DOMContentLoaded', function () {
            // إضافة تأثيرات التحميل للأزرار
            // Add loading effects to buttons
            var submitButtons = document.querySelectorAll('button[type="submit"]');
            submitButtons.forEach(function (button) {
                button.addEventListener('click', function (e) {
                    var form = this.closest('form');
                    if (form) {
                        // التحقق من صحة النموذج قبل إظهار التحميل
                        // Check form validity before showing loading
                        if (form.checkValidity()) {
                            // تأخير قصير للسماح بإرسال النموذج
                            // Short delay to allow form submission
                            setTimeout(() => {
                                this.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>جاري المعالجة...';
                                this.disabled = true;
                            }, 100);
                        }
                    }
                });
            });
        });
    </script>

    @await RenderSectionAsync("Scripts", required: false)
</body>

</html>
